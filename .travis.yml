language: minimal

dist: focal

sudo: required

addons:
  apt:
    packages:
      - bc
      - bison
      - build-essential
      - ccache
      - curl
      - flex
      - g++-multilib
      - gcc-multilib
      - git
      - git-lfs
      - gnupg
      - gperf
      - imagemagick
      - lib32ncurses5-dev
      - lib32readline-dev
      - lib32z1-dev
      - liblz4-tool
      - libncurses5
      - libncurses5-dev
      - libsdl1.2-dev
      - libssl-dev
      - libwxgtk3.0-gtk3-dev
      - libxml2
      - libxml2-utils
      - lzop
      - pngcrush
      - rsync
      - schedtool
      - squashfs-tools
      - xsltproc
      - zip
      - zlib1g-dev

before_install:
  # Install repo tool manually
  - curl https://storage.googleapis.com/git-repo-downloads/repo > ~/bin/repo
  - chmod a+x ~/bin/repo
  - export PATH=~/bin:$PATH
  
  # Setup git-lfs
  - git lfs install
  
install:
  - git config --global color.ui true
  - git config --global user.email tisrijon9@gmail.com
  - git config --global user.name TISnoob
  # Initialize the repo for crDroid 14.0 with Git LFS
  - repo init -u https://github.com/crdroidandroid/android.git -b 14.0 --git-lfs
  # Sync the repo
  - repo sync --quiet

before_script:
  # Setup ccache
  - export USE_CCACHE=1
  - ccache -M 50G
  
script:
  # Start the build process (you'll need to replace 'target_device' with your device codename)
  - . build/envsetup.sh
  - lunch lineage_lancelot-userdebug
  - mka bacon > /dev/null 2>&1
cache:
  directories:
    - $HOME/.ccache
    - $HOME/.repo

notifications:
  email:
    recipients:
      - tisrijon9@gmail.com
    on_success: always
    on_failure: always
deploy:
  skip_cleanup: true
  provider: releases
  # The secret api_key will be loaded from the environment variables
  api_key: $GITHUB_TOKEN
  file_glob: true
  file: $OUT/*
  on:
    tags: false
    repo: TISnoob/rombuild # Optional: If you want to deploy on different repository
    branch: main
