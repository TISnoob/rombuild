language: minimal

dist: focal

sudo: required

before_install:
  - sudo apt-get update
  - sudo apt-get install -y git curl jq

script:
  # Generate a random image URL (this is a placeholder, you can change it to your own source)
  - IMAGE_URL="https://picsum.photos/200"
  - IMAGE_NAME="random_image_$(date +%s).jpg"

  # Download the image
  - curl -o $IMAGE_NAME $IMAGE_URL

  # Define GitHub repository and release details
  - REPO="your-github-username/your-repo-name"
  - RELEASE_TAG="v$(date +%Y%m%d%H%M%S)"
  - RELEASE_NAME="Random Image Release $(date +%Y-%m-%d)"
  - RELEASE_BODY="This release contains a random image."

  # Create a release via the GitHub API
  - RESPONSE=$(curl -H "Authorization: token $GITHUB_TOKEN" \
      -d "{\"tag_name\": \"$RELEASE_TAG\", \"name\": \"$RELEASE_NAME\", \"body\": \"$RELEASE_BODY\", \"draft\": false, \"prerelease\": false}" \
      https://api.github.com/repos/$REPO/releases)

  # Extract the release ID from the response
  - RELEASE_ID=$(echo $RESPONSE | jq -r .id)

  # Upload the image as a release asset
  - UPLOAD_URL="https://uploads.github.com/repos/$REPO/releases/$RELEASE_ID/assets?name=$IMAGE_NAME"
  - curl -H "Authorization: token $GITHUB_TOKEN" \
      -H "Content-Type: application/octet-stream" \
      --data-binary @$IMAGE_NAME \
      $UPLOAD_URL

notifications:
  email:
    recipients:
      - your-email@example.com
    on_success: always
    on_failure: always
